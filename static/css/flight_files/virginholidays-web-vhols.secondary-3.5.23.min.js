function InfoBox(){window.InfoBox=function(opt_opts){opt_opts=opt_opts||{},google.maps.OverlayView.apply(this,arguments),this.content_=opt_opts.content||"",this.disableAutoPan_=opt_opts.disableAutoPan||!1,this.maxWidth_=opt_opts.maxWidth||0,this.pixelOffset_=opt_opts.pixelOffset||new google.maps.Size(0,0),this.position_=opt_opts.position||new google.maps.LatLng(0,0),this.zIndex_=opt_opts.zIndex||null,this.boxClass_=opt_opts.boxClass||"infoBox",this.boxStyle_=opt_opts.boxStyle||{},this.closeBoxMargin_=opt_opts.closeBoxMargin||"2px",this.closeBoxURL_=opt_opts.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===opt_opts.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=opt_opts.infoBoxClearance||new google.maps.Size(1,1),this.isHidden_=opt_opts.isHidden||!1,this.alignBottom_=opt_opts.alignBottom||!1,this.pane_=opt_opts.pane||"floatPane",this.enableEventPropagation_=opt_opts.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.eventListener1_=null,this.eventListener2_=null,this.eventListener3_=null,this.moveListener_=null,this.contextListener_=null,this.fixedWidthSet_=null},InfoBox.prototype=new google.maps.OverlayView,InfoBox.prototype.createInfoBoxDiv_=function(){var bw,me=this,cancelHandler=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},ignoreHandler=function(e){e.returnValue=!1,e.preventDefault&&e.preventDefault(),me.enableEventPropagation_||cancelHandler(e)};this.div_||(this.div_=document.createElement("div"),this.setBoxStyle_(),"undefined"==typeof this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(bw=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-bw.left-bw.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),this.enableEventPropagation_||(this.eventListener1_=google.maps.event.addDomListener(this.div_,"mousedown",cancelHandler),this.eventListener2_=google.maps.event.addDomListener(this.div_,"click",cancelHandler),this.eventListener3_=google.maps.event.addDomListener(this.div_,"dblclick",cancelHandler),this.eventListener4_=google.maps.event.addDomListener(this.div_,"mouseover",function(e){this.style.cursor="default"})),this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",ignoreHandler),google.maps.event.trigger(this,"domready"))},InfoBox.prototype.getCloseBoxImg_=function(){var img="";return""!==this.closeBoxURL_&&(img="<img",img+=" src='"+this.closeBoxURL_+"'",img+=" align=right",img+=" style='",img+=" position: relative;",img+=" cursor: pointer;",img+=" margin: "+this.closeBoxMargin_+";",img+="'>"),img},InfoBox.prototype.addClickHandler_=function(){var closeBox;""!==this.closeBoxURL_?(closeBox=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(closeBox,"click",this.getCloseClickHandler_())):this.closeListener_=null},InfoBox.prototype.getCloseClickHandler_=function(){var me=this;return function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),me.close(),google.maps.event.trigger(me,"closeclick")}},InfoBox.prototype.panBox_=function(disablePan){var map,bounds,xOffset=0,yOffset=0;if(!disablePan&&(map=this.getMap(),map instanceof google.maps.Map)){map.getBounds().contains(this.position_)||map.setCenter(this.position_),bounds=map.getBounds();var mapDiv=map.getDiv(),mapWidth=mapDiv.offsetWidth,mapHeight=mapDiv.offsetHeight,iwOffsetX=this.pixelOffset_.width,iwOffsetY=this.pixelOffset_.height,iwWidth=this.div_.offsetWidth,iwHeight=this.div_.offsetHeight,padX=this.infoBoxClearance_.width,padY=this.infoBoxClearance_.height,pixPosition=this.getProjection().fromLatLngToContainerPixel(this.position_);if(pixPosition.x<-iwOffsetX+padX?xOffset=pixPosition.x+iwOffsetX-padX:pixPosition.x+iwWidth+iwOffsetX+padX>mapWidth&&(xOffset=pixPosition.x+iwWidth+iwOffsetX+padX-mapWidth),this.alignBottom_?pixPosition.y<-iwOffsetY+padY+iwHeight?yOffset=pixPosition.y+iwOffsetY-padY-iwHeight:pixPosition.y+iwOffsetY+padY>mapHeight&&(yOffset=pixPosition.y+iwOffsetY+padY-mapHeight):pixPosition.y<-iwOffsetY+padY?yOffset=pixPosition.y+iwOffsetY-padY:pixPosition.y+iwHeight+iwOffsetY+padY>mapHeight&&(yOffset=pixPosition.y+iwHeight+iwOffsetY+padY-mapHeight),0!==xOffset||0!==yOffset){map.getCenter();map.panBy(xOffset,yOffset)}}},InfoBox.prototype.setBoxStyle_=function(){var i,boxStyle;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",boxStyle=this.boxStyle_;for(i in boxStyle)boxStyle.hasOwnProperty(i)&&(this.div_.style[i]=boxStyle[i]);"undefined"!=typeof this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},InfoBox.prototype.getBoxWidths_=function(){var computedStyle,bw={top:0,bottom:0,left:0,right:0},box=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(computedStyle=box.ownerDocument.defaultView.getComputedStyle(box,""),computedStyle&&(bw.top=parseInt(computedStyle.borderTopWidth,10)||0,bw.bottom=parseInt(computedStyle.borderBottomWidth,10)||0,bw.left=parseInt(computedStyle.borderLeftWidth,10)||0,bw.right=parseInt(computedStyle.borderRightWidth,10)||0)):document.documentElement.currentStyle&&box.currentStyle&&(bw.top=parseInt(box.currentStyle.borderTopWidth,10)||0,bw.bottom=parseInt(box.currentStyle.borderBottomWidth,10)||0,bw.left=parseInt(box.currentStyle.borderLeftWidth,10)||0,bw.right=parseInt(box.currentStyle.borderRightWidth,10)||0),bw},InfoBox.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var pixPosition=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=pixPosition.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(pixPosition.y+this.pixelOffset_.height)+"px":this.div_.style.top=pixPosition.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible"},InfoBox.prototype.setOptions=function(opt_opts){"undefined"!=typeof opt_opts.boxClass&&(this.boxClass_=opt_opts.boxClass,this.setBoxStyle_()),"undefined"!=typeof opt_opts.boxStyle&&(this.boxStyle_=opt_opts.boxStyle,this.setBoxStyle_()),"undefined"!=typeof opt_opts.content&&this.setContent(opt_opts.content),"undefined"!=typeof opt_opts.disableAutoPan&&(this.disableAutoPan_=opt_opts.disableAutoPan),"undefined"!=typeof opt_opts.maxWidth&&(this.maxWidth_=opt_opts.maxWidth),"undefined"!=typeof opt_opts.pixelOffset&&(this.pixelOffset_=opt_opts.pixelOffset),"undefined"!=typeof opt_opts.alignBottom&&(this.alignBottom_=opt_opts.alignBottom),"undefined"!=typeof opt_opts.position&&this.setPosition(opt_opts.position),"undefined"!=typeof opt_opts.zIndex&&this.setZIndex(opt_opts.zIndex),"undefined"!=typeof opt_opts.closeBoxMargin&&(this.closeBoxMargin_=opt_opts.closeBoxMargin),"undefined"!=typeof opt_opts.closeBoxURL&&(this.closeBoxURL_=opt_opts.closeBoxURL),"undefined"!=typeof opt_opts.infoBoxClearance&&(this.infoBoxClearance_=opt_opts.infoBoxClearance),"undefined"!=typeof opt_opts.isHidden&&(this.isHidden_=opt_opts.isHidden),"undefined"!=typeof opt_opts.enableEventPropagation&&(this.enableEventPropagation_=opt_opts.enableEventPropagation),this.div_&&this.draw()},InfoBox.prototype.setContent=function(content){this.content_=content,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),"undefined"==typeof content.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+content:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(content)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px","undefined"==typeof content.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+content:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(content))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},InfoBox.prototype.setPosition=function(latlng){this.position_=latlng,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},InfoBox.prototype.setZIndex=function(index){this.zIndex_=index,this.div_&&(this.div_.style.zIndex=index),google.maps.event.trigger(this,"zindex_changed")},InfoBox.prototype.getContent=function(){return this.content_},InfoBox.prototype.getPosition=function(){return this.position_},InfoBox.prototype.getZIndex=function(){return this.zIndex_},InfoBox.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},InfoBox.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},InfoBox.prototype.open=function(map,anchor){var me=this;anchor&&(this.position_=anchor.getPosition(),this.moveListener_=google.maps.event.addListener(anchor,"position_changed",function(){me.setPosition(this.getPosition())})),this.setMap(map),this.div_&&this.panBox_()},InfoBox.prototype.close=function(){this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListener1_&&(google.maps.event.removeListener(this.eventListener1_),google.maps.event.removeListener(this.eventListener2_),google.maps.event.removeListener(this.eventListener3_),google.maps.event.removeListener(this.eventListener4_),this.eventListener1_=null,this.eventListener2_=null,this.eventListener3_=null,this.eventListener4_=null),this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)}}function MarkerClusterer(){function ClusterIcon(cluster,styles){cluster.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.cluster_=cluster,this.className_=cluster.getMarkerClusterer().getClusterClass(),this.styles_=styles,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(cluster.getMap())}function Cluster(mc){this.markerClusterer_=mc,this.map_=mc.getMap(),this.gridSize_=mc.getGridSize(),this.minClusterSize_=mc.getMinimumClusterSize(),this.averageCenter_=mc.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,mc.getStyles())}ClusterIcon.prototype.onAdd=function(){var cMouseDownInCluster,cDraggingMapByCluster,cClusterIcon=this;this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){cDraggingMapByCluster=cMouseDownInCluster}),google.maps.event.addDomListener(this.div_,"mousedown",function(){cMouseDownInCluster=!0,cDraggingMapByCluster=!1}),google.maps.event.addDomListener(this.div_,"click",function(e){if(cMouseDownInCluster=!1,!cDraggingMapByCluster){var theBounds,mz,mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"click",cClusterIcon.cluster_),google.maps.event.trigger(mc,"clusterclick",cClusterIcon.cluster_),mc.getZoomOnClick()&&(mz=mc.getMaxZoom(),theBounds=cClusterIcon.cluster_.getBounds(),mc.getMap().fitBounds(theBounds),setTimeout(function(){mc.getMap().fitBounds(theBounds),null!==mz&&mc.getMap().getZoom()>mz&&mc.getMap().setZoom(mz+1)},100)),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseover",cClusterIcon.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseout",cClusterIcon.cluster_)})},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.draw=function(){if(this.visible_){var pos=this.getPosFromLatLng_(this.center_);this.div_.style.top=pos.y+"px",this.div_.style.left=pos.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var img="",bp=this.backgroundPosition_.split(" "),spriteH=parseInt(bp[0].trim(),10),spriteV=parseInt(bp[1].trim(),10),pos=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(pos),img="<img src='"+this.url_+"' style='position: absolute; top: "+spriteV+"px; left: "+spriteH+"px; ",this.cluster_.getMarkerClusterer().enableRetinaIcons_||(img+="clip: rect("+-1*spriteV+"px, "+(-1*spriteH+this.width_)+"px, "+(-1*spriteV+this.height_)+"px, "+-1*spriteH+"px);"),img+="'>",this.div_.innerHTML=img+"<div style='position: absolute;top: "+this.anchorText_[0]+"px;left: "+this.anchorText_[1]+"px;color: "+this.textColor_+";font-size: "+this.textSize_+"px;font-family: "+this.fontFamily_+";font-weight: "+this.fontWeight_+";font-style: "+this.fontStyle_+";text-decoration: "+this.textDecoration_+";text-align: center;width: "+this.width_+"px;line-height:"+this.height_+"px;'>"+this.sums_.text+"</div>","undefined"==typeof this.sums_.title||""===this.sums_.title?this.div_.title=this.cluster_.getMarkerClusterer().getTitle():this.div_.title=this.sums_.title,this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.useStyle=function(sums){this.sums_=sums;var index=Math.max(0,sums.index-1);index=Math.min(this.styles_.length-1,index);var style=this.styles_[index];this.url_=style.url,this.height_=style.height,this.width_=style.width,this.anchorText_=style.anchorText||[0,0],this.anchorIcon_=style.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=style.textColor||"black",this.textSize_=style.textSize||11,this.textDecoration_=style.textDecoration||"none",this.fontWeight_=style.fontWeight||"bold",this.fontStyle_=style.fontStyle||"normal",this.fontFamily_=style.fontFamily||"Arial,sans-serif",this.backgroundPosition_=style.backgroundPosition||"0 0"},ClusterIcon.prototype.setCenter=function(center){this.center_=center},ClusterIcon.prototype.createCss=function(pos){var style=[];return style.push("cursor: pointer;"),style.push("position: absolute; top: "+pos.y+"px; left: "+pos.x+"px;"),style.push("width: "+this.width_+"px; height: "+this.height_+"px;"),style.join("")},ClusterIcon.prototype.getPosFromLatLng_=function(latlng){var pos=this.getProjection().fromLatLngToDivPixel(latlng);return pos.x-=this.anchorIcon_[1],pos.y-=this.anchorIcon_[0],pos.x=parseInt(pos.x,10),pos.y=parseInt(pos.y,10),pos},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var i,bounds=new google.maps.LatLngBounds(this.center_,this.center_),markers=this.getMarkers();for(i=0;i<markers.length;i++)bounds.extend(markers[i].getPosition());return bounds},Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},Cluster.prototype.addMarker=function(marker){var i,mCount,mz;if(this.isMarkerAlreadyAdded_(marker))return!1;if(this.center_){if(this.averageCenter_){var l=this.markers_.length+1,lat=(this.center_.lat()*(l-1)+marker.getPosition().lat())/l,lng=(this.center_.lng()*(l-1)+marker.getPosition().lng())/l;this.center_=new google.maps.LatLng(lat,lng),this.calculateBounds_()}}else this.center_=marker.getPosition(),this.calculateBounds_();if(marker.isAdded=!0,this.markers_.push(marker),mCount=this.markers_.length,mz=this.markerClusterer_.getMaxZoom(),null!==mz&&this.map_.getZoom()>mz)marker.getMap()!==this.map_&&marker.setMap(this.map_);else if(mCount<this.minClusterSize_)marker.getMap()!==this.map_&&marker.setMap(this.map_);else if(mCount===this.minClusterSize_)for(i=0;i<mCount;i++)this.markers_[i].setMap(null);else marker.setMap(null);return this.updateIcon_(),!0},Cluster.prototype.isMarkerInClusterBounds=function(marker){return this.bounds_.contains(marker.getPosition())},Cluster.prototype.calculateBounds_=function(){var bounds=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(bounds)},Cluster.prototype.updateIcon_=function(){var mCount=this.markers_.length,mz=this.markerClusterer_.getMaxZoom();if(null!==mz&&this.map_.getZoom()>mz)return void this.clusterIcon_.hide();if(mCount<this.minClusterSize_)return void this.clusterIcon_.hide();var numStyles=this.markerClusterer_.getStyles().length,sums=this.markerClusterer_.getCalculator()(this.markers_,numStyles);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(sums),this.clusterIcon_.show()},Cluster.prototype.isMarkerAlreadyAdded_=function(marker){var i;if(this.markers_.indexOf)return this.markers_.indexOf(marker)!==-1;for(i=0;i<this.markers_.length;i++)if(marker===this.markers_[i])return!0;return!1},window.MarkerClusterer=function MarkerClusterer(map,opt_markers,opt_options){this.extend(MarkerClusterer,google.maps.OverlayView),opt_markers=opt_markers||[],opt_options=opt_options||{},this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.gridSize_=opt_options.gridSize||60,this.minClusterSize_=opt_options.minimumClusterSize||2,this.maxZoom_=opt_options.maxZoom||null,this.styles_=opt_options.styles||[],this.title_=opt_options.title||"",this.zoomOnClick_=!0,void 0!==opt_options.zoomOnClick&&(this.zoomOnClick_=opt_options.zoomOnClick),this.averageCenter_=!1,void 0!==opt_options.averageCenter&&(this.averageCenter_=opt_options.averageCenter),this.ignoreHidden_=!1,void 0!==opt_options.ignoreHidden&&(this.ignoreHidden_=opt_options.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==opt_options.enableRetinaIcons&&(this.enableRetinaIcons_=opt_options.enableRetinaIcons),this.imagePath_=opt_options.imagePath||MarkerClusterer.IMAGE_PATH,this.imageExtension_=opt_options.imageExtension||MarkerClusterer.IMAGE_EXTENSION,this.imageSizes_=opt_options.imageSizes||MarkerClusterer.IMAGE_SIZES,this.calculator_=opt_options.calculator||MarkerClusterer.CALCULATOR,this.batchSize_=opt_options.batchSize||MarkerClusterer.BATCH_SIZE,this.batchSizeIE_=opt_options.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE,this.clusterClass_=opt_options.clusterClass||"cluster",navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(opt_markers,!0),this.setMap(map)},MarkerClusterer.prototype.onAdd=function(){var cMarkerClusterer=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){cMarkerClusterer.resetViewport_(!1),this.getZoom()!==(this.get("minZoom")||0)&&this.getZoom()!==this.get("maxZoom")||google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){cMarkerClusterer.redraw_()})]},MarkerClusterer.prototype.onRemove=function(){var i;for(i=0;i<this.markers_.length;i++)this.markers_[i].getMap()!==this.activeMap_&&this.markers_[i].setMap(this.activeMap_);for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();for(this.clusters_=[],i=0;i<this.listeners_.length;i++)google.maps.event.removeListener(this.listeners_[i]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){var i,size;if(!(this.styles_.length>0))for(i=0;i<this.imageSizes_.length;i++)size=this.imageSizes_[i],this.styles_.push({url:this.imagePath_+(i+1)+"."+this.imageExtension_,height:size,width:size})},MarkerClusterer.prototype.fitMapToMarkers=function(){var i,markers=this.getMarkers(),bounds=new google.maps.LatLngBounds;for(i=0;i<markers.length;i++)bounds.extend(markers[i].getPosition());this.getMap().fitBounds(bounds)},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(gridSize){this.gridSize_=gridSize},MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinimumClusterSize=function(minimumClusterSize){this.minClusterSize_=minimumClusterSize},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.setMaxZoom=function(maxZoom){this.maxZoom_=maxZoom},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.setStyles=function(styles){this.styles_=styles},MarkerClusterer.prototype.getTitle=function(){return this.title_},MarkerClusterer.prototype.setTitle=function(title){this.title_=title},MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.setZoomOnClick=function(zoomOnClick){this.zoomOnClick_=zoomOnClick},MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.setAverageCenter=function(averageCenter){this.averageCenter_=averageCenter},MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},MarkerClusterer.prototype.setIgnoreHidden=function(ignoreHidden){this.ignoreHidden_=ignoreHidden},MarkerClusterer.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons_},MarkerClusterer.prototype.setEnableRetinaIcons=function(enableRetinaIcons){this.enableRetinaIcons_=enableRetinaIcons},MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_},MarkerClusterer.prototype.setImageExtension=function(imageExtension){this.imageExtension_=imageExtension},MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_},MarkerClusterer.prototype.setImagePath=function(imagePath){this.imagePath_=imagePath},MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_},MarkerClusterer.prototype.setImageSizes=function(imageSizes){this.imageSizes_=imageSizes},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.setCalculator=function(calculator){this.calculator_=calculator},MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},MarkerClusterer.prototype.setBatchSizeIE=function(batchSizeIE){this.batchSizeIE_=batchSizeIE},MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_},MarkerClusterer.prototype.setClusterClass=function(clusterClass){this.clusterClass_=clusterClass},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.getClusters=function(){return this.clusters_},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.addMarker=function(marker,opt_nodraw){this.pushMarkerTo_(marker),opt_nodraw||this.redraw_()},MarkerClusterer.prototype.addMarkers=function(markers,opt_nodraw){var key;for(key in markers)markers.hasOwnProperty(key)&&this.pushMarkerTo_(markers[key]);opt_nodraw||this.redraw_()},MarkerClusterer.prototype.pushMarkerTo_=function(marker){if(marker.getDraggable()){var cMarkerClusterer=this;google.maps.event.addListener(marker,"dragend",function(){cMarkerClusterer.ready_&&(this.isAdded=!1,cMarkerClusterer.repaint())})}marker.isAdded=!1,this.markers_.push(marker)},MarkerClusterer.prototype.removeMarker=function(marker,opt_nodraw){var removed=this.removeMarker_(marker);return!opt_nodraw&&removed&&this.repaint(),removed},MarkerClusterer.prototype.removeMarkers=function(markers,opt_nodraw){var i,r,removed=!1;for(i=0;i<markers.length;i++)r=this.removeMarker_(markers[i]),removed=removed||r;return!opt_nodraw&&removed&&this.repaint(),removed},MarkerClusterer.prototype.removeMarker_=function(marker){var i,index=-1;if(this.markers_.indexOf)index=this.markers_.indexOf(marker);else for(i=0;i<this.markers_.length;i++)if(marker===this.markers_[i]){index=i;break}return index!==-1&&(marker.setMap(null),this.markers_.splice(index,1),!0)},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},MarkerClusterer.prototype.repaint=function(){var oldClusters=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){var i;for(i=0;i<oldClusters.length;i++)oldClusters[i].remove()},0)},MarkerClusterer.prototype.getExtendedBounds=function(bounds){var projection=this.getProjection(),tr=new google.maps.LatLng(bounds.getNorthEast().lat(),bounds.getNorthEast().lng()),bl=new google.maps.LatLng(bounds.getSouthWest().lat(),bounds.getSouthWest().lng()),trPix=projection.fromLatLngToDivPixel(tr);trPix.x+=this.gridSize_,trPix.y-=this.gridSize_;var blPix=projection.fromLatLngToDivPixel(bl);blPix.x-=this.gridSize_,blPix.y+=this.gridSize_;var ne=projection.fromDivPixelToLatLng(trPix),sw=projection.fromDivPixelToLatLng(blPix);return bounds.extend(ne),bounds.extend(sw),bounds},MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)},MarkerClusterer.prototype.resetViewport_=function(opt_hide){var i,marker;for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();for(this.clusters_=[],i=0;i<this.markers_.length;i++)marker=this.markers_[i],marker.isAdded=!1,opt_hide&&marker.setMap(null)},MarkerClusterer.prototype.distanceBetweenPoints_=function(p1,p2){var R=6371,dLat=(p2.lat()-p1.lat())*Math.PI/180,dLon=(p2.lng()-p1.lng())*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(p1.lat()*Math.PI/180)*Math.cos(p2.lat()*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d},MarkerClusterer.prototype.isMarkerInBounds_=function(marker,bounds){return bounds.contains(marker.getPosition())},MarkerClusterer.prototype.addToClosestCluster_=function(marker){var i,d,cluster,center,distance=4e4,clusterToAddTo=null;for(i=0;i<this.clusters_.length;i++)cluster=this.clusters_[i],center=cluster.getCenter(),center&&(d=this.distanceBetweenPoints_(center,marker.getPosition()),d<distance&&(distance=d,clusterToAddTo=cluster));clusterToAddTo&&clusterToAddTo.isMarkerInClusterBounds(marker)?clusterToAddTo.addMarker(marker):(cluster=new Cluster(this),cluster.addMarker(marker),this.clusters_.push(cluster))},MarkerClusterer.prototype.createClusters_=function(iFirst){var i,marker,mapBounds,cMarkerClusterer=this;if(this.ready_){0===iFirst&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!=typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),mapBounds=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,(-178.48388434375)),new google.maps.LatLng((-85.08136444384544),178.00048865625));var bounds=this.getExtendedBounds(mapBounds),iLast=Math.min(iFirst+this.batchSize_,this.markers_.length);for(i=iFirst;i<iLast;i++)marker=this.markers_[i],!marker.isAdded&&this.isMarkerInBounds_(marker,bounds)&&(!this.ignoreHidden_||this.ignoreHidden_&&marker.getVisible())&&this.addToClosestCluster_(marker);iLast<this.markers_.length?this.timerRefStatic=setTimeout(function(){cMarkerClusterer.createClusters_(iLast)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}},MarkerClusterer.prototype.extend=function(obj1,obj2){return function(object){var property;for(property in object.prototype)this.prototype[property]=object.prototype[property];return this}.apply(obj1,[obj2])},MarkerClusterer.CALCULATOR=function(markers,numStyles){for(var index=0,title="",count=markers.length.toString(),dv=count;0!==dv;)dv=parseInt(dv/10,10),index++;return index=Math.min(index,numStyles),{text:count,index:index,title:title}},MarkerClusterer.BATCH_SIZE=2e3,MarkerClusterer.BATCH_SIZE_IE=500,MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m",MarkerClusterer.IMAGE_EXTENSION="png",MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90],"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}!function(){"use strict";angular.module("vholsHeaderFooterDirectives",["ipCookie"]).config(["$provide",function($provide){var theGoodTouch="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0;$provide.constant("TOUCHY",theGoodTouch)}])}(),function(){"use strict";function touchDetection($rootScope,TOUCHY){function link(scope,element,attrs){TOUCHY?angular.element(document.body).addClass("touch-enabled"):angular.element(document.body).addClass("touch-disabled"),$rootScope.$broadcast("touchy",TOUCHY)}var touchDetection={link:link,restrict:"EA"};return touchDetection}angular.module("vholsHeaderFooterDirectives").directive("touchDetection",touchDetection),touchDetection.$inject=["$rootScope","TOUCHY"]}(),function(){angular.module("vholsHeaderFooterDirectives").directive("browseSearch",function(){return{scope:{url:"@"},link:function($scope){$scope.searchQuery="",$scope.search=function($event){"click"!==$event.type&&"touchend"!==$event.type&&13!==$event.keyCode||(location.href=$scope.url+$scope.searchQuery)}},templateUrl:"header-search.html"}}).directive("pressRelease",function(){return{replace:!0,link:function($scope){var now=moment().format("D^MM^YYYY"),beginning=moment().subtract(3,"months").format("D^MM^YYYY");$scope.pressLink="//www.virginholidays.co.uk/press/0/"+beginning+"/"+now},template:'<a ng-href="{{pressLink}}" class="footer-link press-link">Press</a>'}}).directive("contactUsMobilePopOver",function(){return{scope:!0,link:function($scope,$element){$scope.$on("closeContactUsPopOver",function(){var elTooltip=$element[0].querySelector(".complex-tooltip"),elTemp=$element[0].querySelector(".complex-tooltip");elTooltip.remove(),$element.append(elTemp)})}}}).directive("openingTimes",[function(){var times;return{replace:!1,scope:{type:"@",day:"@",monStart:"@",monEnd:"@",satStart:"@",satEnd:"@",sunStart:"@",sunEnd:"@"},transclude:!0,link:function($scope){if(times||(times={mon:{text:"Mon to Fri",start:$scope.monStart,end:$scope.monEnd},tue:{text:"Mon to Fri",start:$scope.monStart,end:$scope.monEnd},wed:{text:"Mon to Fri",start:$scope.monStart,end:$scope.monEnd},thu:{text:"Mon to Fri",start:$scope.monStart,end:$scope.monEnd},fri:{text:"Mon to Fri",start:$scope.monStart,end:$scope.monEnd},sat:{text:"Saturday",start:$scope.satStart,end:$scope.satEnd},sun:{text:"Sunday",start:$scope.sunStart,end:$scope.sunEnd}}),$scope.times=times,!$scope.day){var day=$scope.date=moment().format("ddd");$scope.day=day.toLowerCase()}},template:function($scope,$element){var tpl="time"===$element.type?'<span class="qa-displayed-opening-time">{{times[day].start}} - {{times[day].end}}</span>':'<span class="pull-left">{{times[day].text}}</span> <span class="pull-right">{{times[day].start}} - {{times[day].end}}</span>';return tpl}}}]).directive("newsletterSignup",["$window",function($window){return{scope:{emailInput:"="},restrict:"A",link:function($scope,$element){$element.on("click",function(e){var signUpUri="/newsletter",bookFlowRegex=new RegExp("^/holiday/|^/hotel|^/flydrive|^/payments"),params=[];bookFlowRegex.test(location.pathname)?"referrerSource=bookflow":"";$scope.emailInput&&params.push("referrerEmail="+$scope.emailInput),
bookFlowRegex.test(location.pathname)&&params.push("referrerSource=bookflow"),signUpUri+="?"+params.join("&"),e.preventDefault(),$window.location.href=signUpUri})}}}]).directive("placeHolder",function(){return{restrict:"AC",link:function(scope,element,attr){void 0==document.createElement("input").placeholder&&element.val(attr.placeholder)}}}).directive("mobileMegaMenu",["$rootScope",function($rootScope){function removeClasses($elem,classes){classes.forEach(function(clazz){$elem.removeClass(clazz)})}function addClasses($elem,classes){classes.forEach(function(clazz){$elem.addClass(clazz)})}var rightIn="right-in",rightOut="right-out",rightOne="right-one",leftOne="left-one",leftIn="left-in";return{scope:{mobileMegaMenu:"@",menuLevel:"@",reverse:"@",submenus:"@"},link:function($scope,$element){function downTheMenu(){if("0"===$scope.menuLevel){var $firstLevel=angular.element(document.querySelectorAll(".first-level-"+$scope.mobileMegaMenu));return $zeroLevel.addClass(leftOne),removeClasses($zeroLevel,[rightIn,leftIn]),removeClasses($firstLevel,[rightOne,rightOut]),$firstLevel.addClass(rightIn),$firstLevel}if("1"===$scope.menuLevel){for(var $upperLevel=$element.parent().parent(),upNum=0,upperClassList=$upperLevel[0].classList,index=0;index<upperClassList.length;index++){var data=upperClassList[index];data.match(/first-level-(\d)/)&&(upNum=parseInt(data.substring(data.lastIndexOf("-")+1,data.length),10))}var $secondLevel=angular.element(document.querySelectorAll(".second-level-"+upNum+"-"+$scope.mobileMegaMenu));return $thisLevel.addClass(leftOne),removeClasses($thisLevel,[rightIn,leftIn]),removeClasses($secondLevel,[rightOne,rightOut]),$secondLevel.addClass(rightIn),$secondLevel}}function upTheMenu(){if("1"===$scope.menuLevel)return addClasses($thisLevel,[rightOne,rightOut]),removeClasses($thisLevel,[rightIn,leftIn,leftOne]),$zeroLevel.removeClass(leftOne),$zeroLevel.addClass(leftIn),$zeroLevel;if("2"===$scope.menuLevel){var $upLevel=angular.element(document.querySelectorAll(".first-level-"+$scope.mobileMegaMenu)),$thirdLevel=$element.parent().parent();return $upLevel.removeClass(leftOne),$upLevel.addClass(leftIn),addClasses($thirdLevel,[rightOne,rightOut]),removeClasses($thirdLevel,[leftIn,rightIn]),$thirdLevel}}function resetMenu(){var $firstLevel=angular.element(document.querySelectorAll(".first-level-list")),$secondLevel=angular.element(document.querySelectorAll(".second-level-list"));$zeroLevel.removeClass(leftOne),removeClasses($firstLevel,[rightIn,leftIn,leftOne]),$firstLevel.addClass(rightOne),removeClasses($secondLevel,[rightIn,rightOut]),$secondLevel.addClass(rightOne)}if($scope.submenus&&"true"===$scope.submenus){var yDist,yStart,$thisLevel=angular.element(document.querySelectorAll(".first-level-list")),$zeroLevel=angular.element(document.querySelectorAll(".zero-level"));$element.on("touchstart",function($event){var touchobj=$event.changedTouches[0];yDist=0,yStart=touchobj.pageY}),$element.on("touchend",function($event){$event.preventDefault();var touchobj=$event.changedTouches[0];if(yDist=Math.abs(touchobj.pageY-yStart),yDist<5&&!$scope.animating){$scope.animating=!0;var $animatingElem;$animatingElem=$scope.reverse?upTheMenu():downTheMenu(),$animatingElem.on("animationend",function(){$scope.animating=!1})}$scope.$emit("resizeParent")}),$scope.$on("$destroy",$rootScope.$on("resetMenu",resetMenu))}}}}]).directive("mobileMegaMenuCollapse",function(){return{link:function($scope,$element,$attrs){function resizeMegaMenu(){var height=$element[0].querySelectorAll(".sub-menu-container")[0].scrollHeight;$element.attr("style","height:"+height+"px")}var $collapse=$attrs.mobileMegaMenuCollapse;$scope.$on("$destroy",$scope.$watch($collapse,function(){$scope[$collapse]?($element.addClass("open"),resizeMegaMenu()):($element.removeClass("open"),$element.removeAttr("style"))})),$scope.$on("$destroy",$scope.$on("resizeParent",resizeMegaMenu)),$scope.$on("$destroy",$scope.$on("closeMegaMenu",function(){$scope.toggleHeaderNav=!1})),window.addEventListener("orientationchange",function(){$scope[$collapse]&&window.setTimeout(resizeMegaMenu,100)}),$scope.$on("$destroy",function(){window.removeEventListener("orientationchange")})}}}).directive("messageBanner",["ipCookie","$timeout",function(ipCookie,$timeout){return{restrict:"AE",scope:!0,link:function($scope,$element,$attrs){var messageId=$attrs.messageBanner,cookie=$attrs.cookie||"messageBanner",expires=parseInt($attrs.expires)||30;ipCookie(cookie)&&ipCookie(cookie).toString()===messageId||($scope.showMessage=!0),$attrs.closeByLink&&$timeout(function(){var $link=$element.find("a");$link.on("click",$scope.close),$scope.$on("destroy",function(){$link.off("click")})}),$scope.close=function(){$scope.showMessage=!1,ipCookie(cookie,messageId,{expires:expires,expirationUnit:"days",path:"/"})}}}}]).directive("countdownClock",function(){return{scope:{endTime:"@"},replace:!0,link:function($scope,$element){function addZero($var){return $var<10?"0"+$var:$var+""}function addClock(){$scope.$emit("clockShow")}$scope.endTime&&!function updateTime(first){var endTime=moment($scope.endTime,"DD-MMM-YYYY HH:mm"),duration=moment.duration(endTime.diff(moment()));first&&duration.asSeconds()&&duration.asSeconds()>0&&addClock();var days=duration.asDays(),hours=duration.asHours(),minutes=duration.asMinutes(),seconds=duration.asSeconds();$scope.days=Math.floor(days),$scope.hours=Math.floor(hours-24*$scope.days),$scope.minutes=Math.floor(minutes-(24*$scope.days*60+60*$scope.hours)),$scope.seconds=Math.floor(seconds-(24*$scope.days*60*60+60*$scope.hours*60+60*$scope.minutes)),$scope.seconds=addZero($scope.seconds),$scope.minutes=addZero($scope.minutes),$scope.hours=addZero($scope.hours),$scope.days=addZero($scope.days),first||$scope.$apply(),setTimeout(updateTime,1e3)}(!0)},templateUrl:"countdown-clock.html"}}).directive("sharedCountdown",function(){return{scope:!0,link:function($scope){$scope.$on("clockShow",function(){$scope.clockShow=!0})}}}).directive("footerSearch",function(){return{scope:{url:"@"},transclude:!0,link:function($scope,element,attrs,ctrl,transclude){transclude($scope,function(clone){element.append(clone)}),$scope.searchQuery="",$scope.search=function($event){"click"!==$event.type&&"touchend"!==$event.type&&13!==$event.keyCode||(location.href=$scope.url+$scope.searchQuery)}}}}).directive("newsletterPopup",["$document","$compile","$templateCache",function($document,$compile,$templateCache){var template=$templateCache.get("newsletter-popup.html");return{scope:{popupType:"@newsletterPopup"},link:function($scope,element){function removePopup(){childScope.$destroy(),popup.remove(),"modal"===$scope.popupType&&bodyEl.removeClass(openBodyClass),$scope.submitted=!1}function clickOff(e){e.target.getAttribute("class")&&e.target.getAttribute("class").match("newsletter-popup-mask")&&removePopup()}var childScope,popup,bodyEl=$document.find("body"),openBodyClass="newsletter-open";$scope.submitted=!1,$scope.close=function(){removePopup()},$scope.$on("newsletterFormSubmit",function(){$scope.submitted=!0}),element.on("click",function(e){e.preventDefault(),popup&&removePopup(),$scope.$apply(function(){childScope=$scope.$new(),popup=$compile(template)(childScope),"modal"===$scope.popupType?(bodyEl.append(popup),bodyEl.addClass(openBodyClass),popup.on("click",clickOff)):element.after(popup)})})}}}]).directive("newsletterSubscribe",["newsletterSignupService",function(newsletterSignupService){return{scope:!0,link:function($scope,$element){function successCallback(response){response.data.success?($scope.submitted=!0,$scope.$emit("newsletterFormSubmit"),scrollElement()):($scope.formData={},$scope.posting=!1)}function errorCallback(){$scope.posting=!1}function scrollElement(){element.getBoundingClientRect().top<0&&element.scrollIntoView()}var element=$element[0];$scope.formData={},$scope.posting=!1,$element.on("submit",function(e){e.preventDefault(),$scope.posting=!0,newsletterSignupService.signup($scope.formData).then(successCallback,errorCallback)})},templateUrl:"newsletter-signup.html"}}]).directive("vholsEmail",function(){var EMAIL_REGEXP=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,4}\.[0-9]{1,4}\.[0-9]{1,4}\.[0-9]{1,4}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,4}))$/;return{require:"?ngModel",link:function(scope,elm,attrs,ctrl){ctrl&&ctrl.$validators.email&&(ctrl.$validators.email=function(modelValue){return ctrl.$isEmpty(modelValue)||EMAIL_REGEXP.test(modelValue)})}}}).service("newsletterSignupService",["$http",function($http){var url="/.rest/newsletter/v1/signup";this.signup=function(data){return $http.post(url,data)}}]).controller("HeaderController",["$scope","$document","$log","TOUCHY",function($scope,$document,$log,TOUCHY){function activate(){$scope.touchy=TOUCHY,document.body.classList.contains("touch-disabled")||document.body.classList.contains("touch-enabled")||$log.warn("Mega Menu needs class touch-disabled or touch-enabled to work, use touch-detection directive"),$scope.$on("touchy",function(_,touchy){$scope.touchy=touchy})}$scope.touchy=!1,activate(),$scope.touchOff=function($event){var $target=angular.element($event.target);$target.hasClass("mega-menu-item")||(closeEveryMenu(),$document.off("touchend",$scope.touchOff)),$scope.$apply()};var closeEveryMenu=function(megaMenu){var mainMenu=megaMenu?megaMenu:$scope.megaMenu;mainMenu.forEach(function(menu){menu.open=!1,menu.hasSubMenus&&closeEveryMenu(menu.subMenu)})};$scope.$watch("megaMenu",function(){$scope.megaMenu.length>0&&$scope.megaMenu.forEach(function(menu,$index){if(menu.level=0,menu.position=$index,menu.hasSubMenus){var subMenu=menu.subMenu;subMenu.forEach(function(subMenuItem,index){subMenuItem.level=1,subMenuItem.position=$index;var count=index+1,thirdOfLength=subMenu.length/3,topMenu=count>thirdOfLength,bottomMenu=count>subMenu.length-thirdOfLength,position="";bottomMenu?position="bottom":topMenu&&(position="middle"),subMenuItem.subMenuPosition=position})}})}),$scope.tabletControl=function($event,menuItem){if(TOUCHY&&menuItem.hasSubMenus){$event.preventDefault(),$event.stopPropagation();var open=menuItem.open;if(0===menuItem.level)closeEveryMenu();else if(1===menuItem.level){var $megaMenuCurr=$scope.megaMenu[menuItem.position];$megaMenuCurr.open=!0,$megaMenuCurr.subMenu.forEach(function(megaMenuSub){megaMenuSub.open=!1})}open||$document.on("touchend",$scope.touchOff),menuItem.open=!open}else window.location=menuItem.link}}])}(),angular.module("vholsHeaderFooterDirectives").run(["$templateCache",function($templateCache){$templateCache.put("countdown-clock.html",'<div class="countdown">\n\t<div class="countdown-counters">\n\t\t<div class="days countdown-counter" id="days">\n\t\t\t<span class="day-char-one time-char">\n\t\t\t\t{{days.slice(0, 1)}}\n\t\t\t</span>\n\t\t\t<span class="day-char-two time-char">\n\t\t\t\t{{days.slice(1, 2)}}\n\t\t\t</span>\n\t\t\t<span class="countdown-label-all">Days</span>\n\t\t</div>\n\t\t<span class="divider pull-left">\n\t\t\t:\n\t\t</span>\n\n\t\t<div class="hours countdown-counter" id="hours">\n\t\t\t<span class="hour-char-one time-char">\n\t\t\t\t{{hours.slice(0, 1)}}\n\t\t\t</span>\n\t\t\t<span class="hour-char-two time-char">\n\t\t\t\t{{hours.slice(1, 2)}}\n\t\t\t</span>\n\t\t\t<span class="countdown-label-all">Hrs</span>\n\t\t</div>\n\t\t<span class="divider pull-left">\n\t\t\t:\n\t\t</span>\n\n\t\t<div class="mins countdown-counter" id="mins">\n\t\t\t<span class="time-char">\n\t\t\t\t{{minutes.slice(0, 1)}}\n\t\t\t</span>\n\t\t\t<span class="time-char">\n\t\t\t\t{{minutes.slice(1, 2)}}\n\t\t\t</span>\n\t\t\t<span class="countdown-label-all">Mins</span>\n\t\t</div>\n\t\t<span class="divider pull-left">\n\t\t\t:\n\t\t</span>\n\n\t\t<div class="secs countdown-counter" id="secs">\n\t\t\t<span class="time-char">\n\t\t\t\t{{seconds.slice(0, 1)}}\n\t\t\t</span>\n\t\t\t<span class="time-char">\n\t\t\t\t{{seconds.slice(1, 2)}}\n\t\t\t</span>\n\t\t\t<span class="countdown-label-all">Secs</span>\n\t\t</div>\n\t</div>\n</div>'),$templateCache.put("header-search.html",'<div class="input-group">\n    <input class="form-control" ng-keypress="search($event)" ng-model="searchQuery" placeholder="Search our website" />\n    <span class="input-group-btn">\n        <button class="search-btn-header btn-primary btn" ng-click="search($event)">\n            <i class="icon-search"></i>\n        </button>\n    </span>\n</div>'),$templateCache.put("newsletter-popup.html",'<div class="newsletter-popup-mask">\n    <i class="icon-cross close hidden-sm hidden-md hidden-lg" ng-click="close()"></i>\n     <div class="newsletter-popup-inner">\n         <div class="newsletter-popup">\n             <i class="icon-cross close hidden-xs" ng-click="close()"></i>\n             <newsletter-subscribe></newsletter-subscribe>\n             <div class="newsletter-popup-submitted" ng-show="submitted"><a ng-click="close($event)" class="close-submitted">Close</a></div>\n             <div class="newsletter-popup-tip"></div>\n         </div>\n     </div>\n</div>'),$templateCache.put("newsletter-signup.html",'<div class="newsletter-signup-form">\n    <div ng-show="!submitted">\n        <div class="newsletter-heading heading-sm">\n            Sign up to receive news, offers and competitions from Virgin Holidays by email\n        </div>\n        <form name="newsletterSignupForm" track-form-event="Newsletter Signup Form">\n            <div class="newsletter-signup-form-fields">\n                <div class="newsletter-signup-form-field">\n                    <label for="newsletterSignupFormFname">First name</label>\n                    <input  id="newsletterSignupFormFname"\n                            class="form-control"\n                            type="text"\n                            ng-model="formData.forename"\n                            ng-model-options="{ debounce: 300 }"\n                            ng-pattern="/^([a-zA-Z-\'’` ]{2,255})$/"\n                            required=""\n                            name="forename"\n                            value="" />\n                </div>\n                <div class="newsletter-signup-form-field">\n                    <label for="newsletterSignupFormEmail">Email</label>\n                    <input  id="newsletterSignupFormEmail"\n                            type="email"\n                            class="form-control"\n                            required=""\n                            ng-model="formData.email"\n                            ng-model-options="{ debounce: 300 }"\n                            vhols-email \n                            snipe-email="Newsletter Signup Form"\n                            name="email"\n                            value="" />\n                    <button type="submit" ng-disabled="newsletterSignupForm.$invalid || posting" class="button button-secondary" ng-class="{\'posting\': posting}">Sign up</button>\n                </div>\n                <div class="error-section ng-cloak">\n                    <p ng-if="newsletterSignupForm.$invalid &amp;&amp; newsletterSignupForm.forename.$error.required &amp;&amp; newsletterSignupForm.forename.$dirty">Please enter a <span class="error-text">first name</span></p>\n                    <p ng-if="newsletterSignupForm.$invalid &amp;&amp; newsletterSignupForm.forename.$error.pattern &amp;&amp; newsletterSignupForm.forename.$dirty">Please enter a valid <span class="error-text">first name</span></p>\n                    <p ng-if="newsletterSignupForm.$invalid &amp;&amp; newsletterSignupForm.email.$error.required &amp;&amp; newsletterSignupForm.email.$dirty">Please enter an <span class="error-text">email address</span></p>\n                    <p ng-if="newsletterSignupForm.$invalid &amp;&amp; newsletterSignupForm.email.$error.email &amp;&amp; newsletterSignupForm.email.$dirty">Please enter a valid <span class="error-text">email address</span></p>\n                </div>\n                <div class="privacy-policy">\n                    For further details, please read our <a target="_blank" href="/important/privacy-statement">privacy policy.</a><br>\n                    You can unsubscribe at any time.\n                </div>\n                <button type="submit" ng-disabled="newsletterSignupForm.$invalid || posting" class="button button-primary" ng-class="{\'posting\': posting}">Sign up</button>\n            </div>\n        </form>\n    </div>\n    <div class="ng-cloak ng-hide" ng-show="submitted">\n        <h2 class="newsletter-heading">\n            Thanks for signing up\n        </h2>\n        <p class="newsletter-subheading">Keep an eye on your email for the latest special offers from us.</p>\n    </div>\n</div>')}]),function(){angular.module("vholsDirectivesGeneral",[]).directive("scrollEvents",["$window","$rootScope",function($window,$rootScope){return{restrict:"A",link:function($scope,$element,$attr){function createEmitter(eventName){return function(){var topVisible,bottomVisible,visible,rect=$element[0].getBoundingClientRect();topVisible=rect.top>tolerance,bottomVisible=rect.bottom<$window.innerHeight+tolerance,visible=topVisible||bottomVisible||rect.top<0&&rect.bottom>$window.innerHeight,$scope.$emit(eventName,{topVisible:topVisible,bottomVisible:bottomVisible,visible:visible,bounds:rect})}}var emitter,tolerance=parseInt($attr.tolerance||"0",10);emitter=createEmitter($attr.scrollEvents),$window.addEventListener("resize",emitter),$window.addEventListener("scroll",emitter),$scope.$on("$destroy",function(){$window.removeEventListener("resize",emitter),$window.removeEventListener("scroll",emitter)})}}}])}(),angular.module("vholsDirectivesGeneral").run(["$templateCache",function($templateCache){}]),function(module){"use strict";var _formSubmit=function(name,event,content){"undefined"!=typeof trackEvent&&trackEvent(name,event,content)},_snipeEmail=function(name,email){"undefined"!=typeof trackLogin&&trackLogin(name,email)},_arrayConcat=function(list,separator){var filteredList=list.filter(function(val){return val&&val.length>0}),unkebabed=filteredList.map(function(str){return str.replace("-"," ")});return unkebabed.join(separator)};module.constant("TRACKING_CONSTANTS",{blur:"blur",submit:"submit",submitForm:"Submit Form",googleSeparator:" - ",arrayType:"array"}),module.service("TrackingService",function(){return{formSubmit:_formSubmit,snipeEmail:_snipeEmail,arrayConcat:_arrayConcat}}),module.directive("snipeEmail",["TRACKING_CONSTANTS","TrackingService",function(TRACKING_CONSTANTS,TrackingService){return{link:function($scope,$element,$attrs){$element.on(TRACKING_CONSTANTS.blur,function(){TrackingService.snipeEmail($attrs.snipeEmail,$element.val())})}}}]),module.directive("trackFormEvent",["TRACKING_CONSTANTS","TrackingService",function(TRACKING_CONSTANTS,TrackingService){return{scope:{trackFormEvent:"@",content:"@",contentAs:"@"},link:function($scope,$element){$element.on(TRACKING_CONSTANTS.submit,function(){var content=$scope.content;$scope.contentAs&&$scope.contentAs===TRACKING_CONSTANTS.arrayType&&(content=TrackingService.arrayConcat(JSON.parse($scope.content),TRACKING_CONSTANTS.googleSeparator)),TrackingService.formSubmit($scope.trackFormEvent,TRACKING_CONSTANTS.submitForm,content)})}}}])}(angular.module("vholsTracking",[])),function(){angular.module("vholsLightBox",[]).directive("vholsLightbox",function(){return{replace:!0,template:'<div class="light-box-outer"><div class="light-box-container"><div class="light-box"><i class="icon-x-symbol lightbox-close"></i><div class="light-box-content"></div></div></div></div>'}}).directive("lightboxControl",function(){return function($scope,$element){$element.on("click",function(e){var $container=angular.element(document.querySelectorAll(".light-box-container")),$outer=angular.element(document.querySelectorAll(".light-box-outer")),$lightbox=angular.element(document.querySelectorAll(".light-box")),$lightboxContent=angular.element(document.querySelectorAll(".light-box-content"));$outer.addClass("light-box-open"),"click touchstart".split(" ").forEach(function(eventName){$container.on(eventName,function(){$lightboxContent.html(""),$lightbox.removeClass("elements"),$outer.removeClass("light-box-open")})}),"click touchstart".split(" ").forEach(function(eventName){$lightboxContent.on(eventName,function(e){e.stopPropagation()})}),e.preventDefault()})}}).directive("elementLightbox",function(){return{scope:{lightboxTarget:"@"},link:function($scope,$element){$element.on("click",function(){var $template=angular.element($element[0].querySelector($scope.lightboxTarget)),contents=$template.html(),$lightbox=angular.element(document.querySelectorAll(".light-box-content"));$lightbox.parent().addClass("elements"),$lightbox.append(contents)})}}}),angular.module("vholsYoutube",[]).directive("youtubeTitle",["$http",function($http){return{replace:!1,transclude:!0,scope:{videoId:"@",titleStart:"@"},link:function($scope){var url="//gdata.youtube.com/feeds/api/videos/"+$scope.videoId+"?v=2&alt=jsonc",getTitle=function(resp){$scope.title=resp.data.data.title};$http({method:"GET",url:url,cache:!0}).then(getTitle)},template:'<p class="tts-video-pod-title qa-tts-video-pod-title"><strong>{{titleStart}} </strong>{{title}}</p>'}}]).directive("youtubeVideo",function(){return{link:function($scope,$element){$element.on("click",function(){var videoUrl="http://www.youtube.com/embed/"+$element.attr("youtube-video"),template="<div class='youtube-video-container'><iframe class='youtube-video' src='"+videoUrl+"' frameborder='0' allowfullscreen></iframe></div>";angular.element(document.querySelectorAll(".light-box-content")).append(template)})}}}),angular.module("vholsIframeLb",[]).directive("vholsIframe",function(){return{replace:!1,scope:{iframeSrc:"@",iframeName:"@"},link:function($scope,$element){$element.on("click",function(){var template='<iframe src="'+$scope.iframeSrc+'" name="'+$scope.iframeName+'" style="height:600px;width:100%"></iframe>';angular.element(document.querySelectorAll(".light-box-content")).append(template)})}}})}(),function(){"use strict";var debounce=function(func,threshold){var timeout;return function(){function delayed(){func.apply(obj,args),timeout=null}var obj=this,args=arguments;timeout&&clearTimeout(timeout),timeout=setTimeout(delayed,threshold)}};vhols.eventDebounce=function(fn,event,bindTo,threshold){return fn?vhols.angEl(bindTo).on(event,debounce(fn,threshold?threshold:100)):vhols.angEl(bindTo).triggerHandler("eventDebounce")}}(),function(){"use strict";function sanitizeHtml(html){var cleaned="";return cleaned=/script/.test(html)&&/<style/.test(html)?html.replace(/<script>[\s\S]*?<\/script>/,"").replace(/<style>[\s\S]*?<\/style>/,""):html}var socialNetworks={facebook:"http://www.facebook.com/sharer/sharer.php?s=100&p[url]=",twitter:"https://twitter.com/intent/tweet?text=",gplus:"https://plus.google.com/share?url=",pinterest:"//www.pinterest.com/pin/create/button/?description="};angular.module("socialSharing",[]).directive("socialShare",function(){return{replace:!0,scope:{shareSentence:"@",currDestination:"@",shareLink:"@",imageLink:"@",socialNetwork:"@",pinImage:"@"},link:function($scope,$element){$scope.shareLink&&""!==$scope.shareLink||($scope.shareLink=encodeURIComponent(location.href));var shareContent="";shareContent="twitter"===$scope.socialNetwork||"pinterest"===$scope.socialNetwork?$scope.shareSentence&&""!==$scope.shareSentence?$scope.shareSentence.replace("**destination**",$scope.currDestination).replace("#",encodeURIComponent("#")).replace("**url**",location.href)+"&media="+location.protocol+"//"+location.host+$scope.pinImage:"&media="+location.protocol+"//"+location.host+$scope.pinImage:$scope.shareLink,$scope.href=socialNetworks[$scope.socialNetwork]+shareContent,!$scope.imageLink||/.imaging\/Desktop\/dam\/$/.test($scope.imageLink)||/^$|\s+/.test($scope.imageLink)?($element.parent().addClass("mode-icons"),$scope.logoTag='<i class="social-share-icon icon-'+$scope.socialNetwork+'"/>'):$scope.logoTag='<img class="social-share-icon" src="'+$scope.imageLink+'"/>',$scope.popupWindow=function(){return!window.open($scope.href,$scope.socialNetwork,"width=640,height=300")}},template:'<a id="qa-{{socialNetwork}}-share" class="{{socialNetwork}}-share" target="_blank" ng-click="popupWindow()" data-pin-shape="round" data-pin-height="20" data-pin-do="buttonBookmark"><span ng-bind-html="logoTag | to_trusted"></span></a>'}}).directive("emailPage",["$window",function($window){return{restrict:"E",scope:{subject:"@",body:"@"},replace:!0,transclude:!0,link:function($scope,$element,$attrs){$scope.subject=$scope.subject||"You have been sent a link to Virgin Holidays",$scope.body=$scope.body||"Hi,%0A%0AYou have been sent a page by Virgin Holidays.%0A%0A"+escape($window.location.href)},template:'<a href="mailto:?subject={{subject}}&body={{body}}" class="email-link qa-email-link"><i class="social-share-icon icon-envelope"></i></a>'}}]).filter("to_trusted",["$sce",function($sce){return function(text){var cleaned=sanitizeHtml(text);return $sce.trustAsHtml(cleaned)}}])}(),function(){angular.module("vhols-ratings",[]).directive("vRating",[function(){function ratingStringify(score){var mappedRating=ratingMapping[score.toUpperCase()]||score;return mappedRating.replace(halfPoints,"-plus").toLowerCase()}var halfPoints=/\.5|\+/,ratingMapping={NA:"villa",VILLAS:"villa"};return{scope:{score:"@"},link:function($scope,$elem,$attrs){var prefix="rating-";$scope.className=$attrs.className||"hotel-rating",$scope.$on("$destroy",$scope.$watch("score",function(value){if(value){var normalRating=ratingStringify(value);$scope.result=prefix+normalRating}$scope.hidden=!value}))},template:'<div class="{{className}} {{result}}"></div>'}}])}(),function(){"use strict";angular.module("vhols-smooth-scroll",[]).service("anchorSmoothScroll",["$window",function($window){this.scrollTo=function(eID){function currentYPosition(){return $window.pageYOffset?$window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}var startY=currentYPosition(),stopY=elmYPosition(eID),distance=stopY>=startY?stopY-startY:startY-stopY,speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(var i=startY;i<stopY;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(var a=startY;a>stopY;a-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,leapY<stopY&&(leapY=stopY),timer++}}])}(),function(){"use strict";angular.module("vhols-destination-navbar",[]).directive("navBar",["$window",function($window){return{restrict:"E",scope:{overview:"@",hotels:"@",offers:"@",tours:"@",multicentres:"@",thingsToSee:"@",destinationsIn:"@"},link:function($scope){var $thingsToSee=document.getElementsByClassName("tts-container"),$destinationsIn=document.getElementsByClassName("destinations-in");$scope.mainLinks=[{name:"Overview",url:$scope.overview,show:!0,active:/-holidays$/.test($window.location.pathname)},{name:"Destinations in",url:$scope.destinationsIn?$scope.destinationsIn:$destinationsIn?"#destinations-in":"",show:void 0!==$scope.destinationsIn||$destinationsIn.length>0,active:!!~$window.location.pathname.indexOf("destinations-in")},{name:"Things to see",url:$scope.thingsToSee?$scope.thingsToSee:$thingsToSee?"#things-to-see":"",show:void 0!==$scope.thingsToSee||$thingsToSee.length>0,active:!!~$window.location.pathname.indexOf("things-to-see")},{name:"Hotels",url:$scope.hotels,show:$scope.hotels,active:!!~$window.location.pathname.indexOf("-hotels")},{name:"Offers",url:$scope.offers,show:$scope.offers,id:"qa-navbar-offers",active:!!~$window.location.pathname.indexOf("-offers")},{name:"Tours",url:$scope.tours,show:$scope.tours,active:!!~$window.location.pathname.indexOf("-tours")},{name:"Multi-centres",url:$scope.multicentres,show:$scope.multicentres,active:!!~$window.location.pathname.indexOf("/multi-centre")}],$scope.pageType="Overview",$scope.mainLinks.forEach(function(link){link.active&&($scope.pageType=link.name)})},templateUrl:"destination-navbar.html"}}]).directive("holidayTypesNavBar",function(){return{link:function($scope,$element,$attrs){$scope.mainLinks=JSON.parse($attrs.holidayTypes),$scope.pageType="Overview",$scope.mainLinks.forEach(function(link){link.active&&($scope.pageType=link.name)}),angular.element(document).ready(function(){window.dispatchEvent(new CustomEvent("initialise-fixed-tabs"))})},templateUrl:"destination-navbar.html"}})}(),function(){"use strict";angular.module("vhols-destination-navbar").run(["$templateCache",function($templateCache){$templateCache.put("destination-navbar.html",'<div class="navbar-container">\n    <div class="container">\n        <nav class="fixed-tabs" aria-label="Destinations navigation bar">\n            <ul class="fixed-tabs-list">\n                <li ng-repeat="link in mainLinks" class="fixed-tabs-list-item" data-tab-index="{{$index}}">\n                    <a ng-if="link.active" ng-href="{{link.url}}" class="active" aria-current="page">{{link.name}}</a>\n                    <a ng-if="!link.active" ng-href="{{link.url}}">{{link.name}}</a>\n                </li>\n                <li class="fixed-tabs-more" tabindex="0">\n                    <a href="javascript:void(0)" class="fixed-tabs-sub-menu-button" tabindex="-1">\n                        More\n                        <svg width="10px" height="10px" role="presentation">\n                            <use xlink:href="/.resources/virginholidays-web-vhols/versioned/pattern-library/sprites/icons.svg#solid-arrow-down"></use>\n                        </svg>\n                    </a>\n                    <ul class="fixed-tabs-sub-menu">\n                        <li ng-repeat="link in mainLinks" class="fixed-tabs-sub-item tab-gone" data-tab-index="{{$index}}">\n                            <a ng-if="link.active" ng-href="{{link.url}}" class="active" aria-current="page">{{link.name}}</a>\n                            <a ng-if="!link.active" ng-href="{{link.url}}">{{link.name}}</a>\n                        </li>\n                    </ul>\n                </li>\n            </ul>\n        </nav>\n    </div>\n</div>\n')}])}(),function(){"use strict";function onLoad(callback){loaded?callback():callbacks.push(callback)}var app=angular.module("vhols-maps",[]),MAP_URL="//maps.googleapis.com/maps/api/js?key={{mapkey}}&libraries=places&callback=vhols.maps.load",callbacks=[],loaded=!1;window.vhols=null!=window.vhols?window.vhols:{},window.vhols.maps=null!=window.vhols.maps?window.vhols.maps:{},window.vhols.maps.load=function(){loaded=!0,window.InfoBox(),window.MarkerClusterer(),callbacks.forEach(function(callback){callback()})},angular.element(document).ready(function(){if(window.vhols.maps.key){var script=window.document.createElement("script");script.type="text/javascript",script.src=MAP_URL.replace("{{mapkey}}",window.vhols.maps.key),window.document.querySelector("head").appendChild(script)}}),app.service("vholsMapTools",["$interpolate","$compile",function($interpolate,$compile){return{initialise:function($scope,$el){$scope.map=new google.maps.Map($el[0],{disableDefaultUI:!0,scrollwheel:!1,panControl:!0,zoomControl:!0,scaleControl:!0});var boundsListener=google.maps.event.addListener($scope.map,"bounds_changed",function(){google.maps.event.trigger($scope.map,"resize"),google.maps.event.removeListener(boundsListener)});$scope.markerClusterer=new MarkerClusterer($scope.map,[],{minimumClusterSize:5,averageCenter:!0,imagePath:"/docroot/virginholidays-web-common/images/google-maps/m"}),google.maps.event.addListener($scope.map,"click",function(){$scope.map.setOptions({scrollwheel:!0})}),google.maps.event.addListener($scope.map,"mouseout",function(){$scope.map.setOptions({
scrollwheel:!1})})},populateMarkers:function($scope,collection,infoBoxTemplate){$scope.markers=$scope.markers?this.clearMarkers($scope):[],$scope.bounds=new google.maps.LatLngBounds;var coordinates=[],filterdCoordinates=[],itineraryHolidayIconType="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=",itineraryHolidayIconColour="|888|fff";$scope.infobox=new InfoBox({alignBottom:!0,pixelOffset:new google.maps.Size((-50),(-40)),closeBoxURL:""});var markerScope=$scope.$new();collection.forEach(function(item,index){if(null!=item){var latLng={lat:"itinerary"===$scope.holidayType?item.location.lat:item.hotel.content.location.lat,lng:"itinerary"===$scope.holidayType?item.location.lon:item.hotel.content.location.lon},pos=new google.maps.LatLng(latLng);if(item.location&&coordinates.push(pos),0===filterdCoordinates.filter(function(mapped){return mapped.equals(pos)}).length){var marker=new google.maps.Marker({position:pos,title:item.description,icon:"itinerary"===$scope.holidayType?itineraryHolidayIconType+(index+1)+itineraryHolidayIconColour:null});item.location&&filterdCoordinates.push(pos),$scope.bounds.extend(pos),infoBoxTemplate&&google.maps.event.addListener(marker,"click",function(){var ctx=this;markerScope.$destroy(),$scope.infobox&&$scope.infobox.close(),markerScope=$scope.$new(),$scope.infobox.setContent($compile(infoBoxTemplate)(markerScope)[0]),markerScope.item=item,markerScope.$digest(),$scope.infobox.open($scope.map,ctx)}),$scope.markers.push(marker)}}}),$scope.markerClusterer.addMarkers($scope.markers),$scope.flightPathEnabled&&this.createItineraryPath($scope,coordinates,"#ED1937").setMap($scope.map),this.correctBounds($scope)},clearMarkers:function($scope){return $scope.infobox&&$scope.infobox.close(),$scope.markerClusterer.removeMarkers($scope.markers),[]},correctBounds:function($scope){var zoom=/^\d+$/.test($scope.zoom)?parseInt($scope.zoom,10):null;$scope.map.fitBounds($scope.bounds),zoom&&zoom>0&&zoom<16&&$scope.map.setZoom($scope.zoom)},createItineraryPath:function($scope,coordinates,colour){var lineSymbol={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeOpacity:1,scale:2,strokeColor:colour},itineraryPath=new google.maps.Polyline({path:coordinates,geodesic:!1,strokeWeight:2,strokeColor:colour,icons:[{icon:lineSymbol,offset:"100%",repeat:"100px"}]});return itineraryPath}}}]),app.directive("vholsMap",["$templateCache","vholsMapTools","$window","$interpolate",function($templateCache,MapTools,$window,$interpolate){return{scope:{collection:"=",visible:"=",zoom:"=",flightPathEnabled:"=",holidayType:"="},compile:function(_,$attr){var infoBoxTemplate=null!=$attr.infoBox?$templateCache.get($attr.infoBox):null;return function($scope,$element){/^\d+$/.test($scope.zoom)?parseInt($scope.zoom,10):null;onLoad(function(){function watchVisibility(visible){visible?(MapTools.populateMarkers($scope,null!=$scope.collection?$scope.collection:[],infoBoxTemplate),disposable=$scope.$watch("collection",function(collection){MapTools.populateMarkers($scope,null!=collection?collection:[],infoBoxTemplate),correctBounds()},!0)):disposable&&disposable(),visible&&$scope.markers&&correctBounds()}function correctBounds(){setTimeout(function(){google.maps.event.trigger($scope.map,"resize"),MapTools.correctBounds($scope)},0)}var disposable;MapTools.initialise($scope,$element),$scope.visible&&(MapTools.populateMarkers($scope,null!=$scope.collection?$scope.collection:[],infoBoxTemplate),disposable=$scope.$watch("collection",function(collection){MapTools.populateMarkers($scope,null!=collection?collection:[],infoBoxTemplate),correctBounds()},!0)),$scope.$watch("visible",watchVisibility),$scope.$on("visibilityChanged",watchVisibility),$scope.closeInfoBox=function(){$scope.infobox.close()}})}}}}])}(),function(){"use strict";angular.module("vhols-maps").run(["$templateCache",function($templateCache){$templateCache.put("attractionWindow.html",'<article>\n    <div class="info-window">\n        <h2 class="title">{{attraction.name}}</h2>\n\n        <div class="content">\n            <div class="image">\n                <img ng-src="{{attraction.image}}" />\n            </div>\n\n            <div class="contents">\n                <img class="attraction-icon" ng-src="{{attraction.icon}}"/> <span class="attraction-type">{{attraction.type}}</span>\n            </div>\n        </div>\n    </div>\n    <a class="btn btn-primary btn-block">More details <i class="icon-chevron-right"></i></a>\n</article>'),$templateCache.put("itineraryHolidayPopup.html",'<div class="info-window itinerary-holiday">\n    <a href="" class="info-close" ng-click="closeInfoBox()">X</a>\n    <div class="row">\n        <div class="col-xs-12">\n            <h5 class="info-title">\n                {{item.description}}\n            </h5>\n        </div>\n    </div>\n</div>\n'),$templateCache.put("searchResultPopup.html",'<div class="map-card">\n    <div class="card">\n        <a href="" class="card-close" ng-click="closeInfoBox()">\n            <i class="du-icon-x-symbol"></i>\n        </a>\n        <div class="card-img">\n            <img ng-src="{{item.hotel.content.images[0].MOBILE_MAIN.url}}" class="card-img-top" alt="Card image cap">\n        </div>\n        <div class="card-block">\n            <h4 class="card-title">{{item.hotel.content.name}}</h4>\n            <h6 class="card-subtitle">{{item.hotel.content.parentLocation}}</h6>\n            <div class="flex-card-block hotel-rating-info">\n                <div class="tripadvisor" ng-show="item.hotel.tripAdvisor.ratingImageUrl">\n                    <img src="" ng-src="{{item.hotel.tripAdvisor.ratingImageUrl}}" />\n                    <span class="tripadvisor-title">Based on {{item.hotel.tripAdvisor. numReviews}} reviews</span>\n                </div>\n                <div class="rating">\n                    <v-rating score="{{item.hotel.content.vRating}}" class="rating"></v-rating>\n                    <span ng-show="item.hotel.content.vRating" class="rating-title">Hotel rating</span>\n                </div>\n            </div>\n            <div ng-if="item.specialOffers" class="flex-card-block body-sm-unpadded">\n                <div ng-show="item.specialOffers.departureAirport">\n                    <div class="text-indent">\n                        <svg width="16px" height="16px">\n                            <use xlink:href="/.resources/virginholidays-web-vhols/versioned/pattern-library/sprites/icons.svg#outline-plane">\n                        </svg>\n                        <span>{{item.specialOffers.departureAirport}}</span>\n                    </div>\n                </div>\n                <div ng-show="item.specialOffers.duration">\n                    <div class="text-indent">\n                        <svg width="16px" height="16px">\n                            <use xlink:href="/.resources/virginholidays-web-vhols/versioned/pattern-library/sprites/icons.svg#outline-bed">\n                        </svg>\n                        <span>{{item.specialOffers.duration}} nights</span>\n                    </div>\n                </div>\n                <div ng-show="item.specialOffers.minCheckInDate">\n                    <div class="text-indent">\n                        <svg width="16px" height="16px">\n                            <use xlink:href="/.resources/virginholidays-web-vhols/versioned/pattern-library/sprites/icons.svg#outline-calendar">\n                        </svg>\n                        <span>{{item.specialOffers.minCheckInDate | date :\'d MMM yyyy\'}}</span>\n                    </div>\n                </div>\n                <div ng-show="item.specialOffers.boardBasisName">\n                    <div class="text-indent">\n                        <svg width="16px" height="16px">\n                            <use xlink:href="/.resources/virginholidays-web-vhols/versioned/pattern-library/sprites/icons.svg#dining">\n                        </svg>\n                        <span>{{item.specialOffers.boardBasisName}}</span>\n                    </div>\n                </div>\n            </div>\n            <div class="offer-saving-info" ng-if="item.specialOffers">\n                <span class="saving-copy">\n                    <span ng-if="item.specialOffers.savingPercentage > 20">SAVE {{item.specialOffers.savingPercentage}}%</span>\n                    <span ng-if="item.specialOffers.savingPercentage > 20 &amp;&amp; item.specialOffers.ksps"> + </span>\n                    <span ng-if="item.specialOffers.ksps">{{item.specialOffers.ksps[0].kspText}}</span>\n                </span>\n            </div>\n            <div ng-if="!item.specialOffers && item.hotel.boardOptions" class="heading-padding-md">\n                <p class="card-text body-sm-unpadded"><strong>{{item.hotel.boardOptions[0].name</strong></p>\n            </div>\n            <div class="flex-card-block bottom-block">\n                <div class="price-block" ng-hide="!item.pricePerPerson">\n                    <span>from</span>\n                    <h2 class="heading-md">\n                        {{item.pricePerPerson | currency : "&pound;" : 0 }}<span class="heading-xxs">pp</span>\n                    </h2>\n                </div>\n                <div class="button-block">\n                    <a ng-if="item.pricePerPerson && !item.specialOffers" options-link="HOTEL" value="item.hotel" class="card-link">Continue</a>\n                    <a ng-if="!item.pricePerPerson && !item.specialOffers" hotel-link-browse="item.hotel" class="card-link">More details</a>\n                    <a ng-if="item.specialOffers" hotel-link-offers="item" class="card-link">More details</a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(module){"use strict";function extend(child,parent){function Ctor(){this.constructor=child}for(var key in parent)__hasOwn.call(parent,key)&&(child[key]=parent[key]);return Ctor.prototype=parent.prototype,child.prototype=new Ctor,child.__super__=parent.prototype,child}function flatMap(array){return array.reduce(function(flat,array){return flat.concat(array)},[])}function andFilter(ids){var groupCount=ids.length,flat=flatMap(ids),collector=flat.reduce(function(collector,id){return collector[id]=null!=collector[id]?collector[id]+1:1,collector},{});return Object.keys(collector).reduce(function(ids,id){return ids.concat(collector[id]===groupCount?[id]:[])},[])}function orFilter(ids){var flat=flatMap(ids);return Object.keys(flat.reduce(function(collector,next){return collector[next]=!0,collector},Object.create(null)))}function AbstractFilter(name){this.name=name,this.disabled=!1,this._group=null}function FilterGroup(type,name,mode,filters){this.type=type,this.name=name,this.filters=filters,this._mode=mode,this._mediator=null}function HierarchyFilterGroup(type,name,mode,filters){HierarchyFilterGroup.__super__.constructor.call(this,type,name,mode,filters)}function CheckBoxFilter(name,ids){CheckBoxFilter.__super__.constructor.apply(this,[name]),this.checked=!1,this.count=ids.length,this.filteredCount=ids.length,this._ids=ids}function HierarchyFilter(name,id,filters){HierarchyFilter.__super__.constructor.apply(this,[name]),this.checked=!1,this.filters=filters,this._id=id,this._resetCount()}function TextFilter(textMap){TextFilter.__super__.constructor.apply(this,[""]),this.text="",this._textMap=textMap}function FilterMediator(groups){this._batch=!1,this.groups=groups,this.filteredCount=0,this._listeners=[]}function FilterBuilder(){this._builders=[]}function AbstractFilterGroupBuilder(type,name,mode){this._type=type,this._name=name,this._mode=mode=null!=mode?mode:FilterGroup.MODE.OR,this._filters=[]}function CheckBoxFilterGroupBuilder(type,name,mode){CheckBoxFilterGroupBuilder.__super__.constructor.apply(this,[type,name,mode])}function TextFilterGroupBuilder(name){TextFilterGroupBuilder.__super__.constructor.apply(this,["text",name])}function HierarchyFilterGroupBuilder(name){HierarchyFilterGroupBuilder.__super__.constructor.apply(this,["hierarchy",name])}function HierarchyFilterBuilder(name,id){this._name=name,this._id=id,this._filters=[]}var __hasOwn={}.hasOwnProperty;AbstractFilter.prototype.change=function(){return this._group.change(),this},AbstractFilter.prototype.visit=function(visitor){return visitor.acceptFilter&&visitor.acceptFilter(this),visitor},AbstractFilter.prototype._setGroup=function(group){return this._group=group,this},AbstractFilter.prototype._reset=function(){return this.disabled=!1,this},AbstractFilter.prototype._collect=function(){return[]},AbstractFilter.prototype._isFilterApplied=function(){return!1},AbstractFilter.prototype._calculate=function(filteredIds){},FilterGroup.MODE={},FilterGroup.MODE.AND="AND",FilterGroup.MODE.OR="OR",FilterGroup.prototype.change=function(){return this._mediator.change(),this},FilterGroup.prototype.reset=function(){return this.filters.forEach(function(filter){filter._reset()}),this},FilterGroup.prototype.isFilterApplied=function(){return this.filters.some(function(filter){return filter._isFilterApplied()})},FilterGroup.prototype.visit=function(visitor){return visitor.acceptGroup&&visitor.acceptGroup(this),this.filters.forEach(function(filter){filter.visit(visitor)}),visitor},FilterGroup.prototype._setMediator=function(mediator){return this._mediator=mediator,this},FilterGroup.prototype._collect=function(){var collected=this.filters.reduce(function(collector,filter){return collector.push(filter._collect()),collector},[]);return collected=collected.filter(function(filter){return filter.length>0}),collected=this._mode===FilterGroup.MODE.OR?orFilter(collected):andFilter(collected),Object.keys(collected.reduce(function(collector,next){return collector[next]=!0,collector},Object.create(null)))},FilterGroup.prototype._calculate=function(filteredIds){this.filters.forEach(function(filter){filter._calculate(filteredIds)})},extend(HierarchyFilterGroup,FilterGroup),HierarchyFilterGroup.prototype._collect=function(){var collected=flatMap(this.filters.reduce(function(collector,filter){return collector.push(filter._collect()),collector},[]));return collected=this._mode===FilterGroup.MODE.OR?orFilter(collected):andFilter(collected),Object.keys(collected.reduce(function(collector,next){return collector[next]=!0,collector},Object.create(null)))},extend(CheckBoxFilter,AbstractFilter),CheckBoxFilter.prototype._reset=function(){return this.checked=!1,this.filteredCount=this._ids.length,CheckBoxFilter.__super__._reset.apply(this,arguments)},CheckBoxFilter.prototype._collect=function(){return this.checked?this._ids:[]},CheckBoxFilter.prototype._isFilterApplied=function(){return this.checked},CheckBoxFilter.prototype._calculate=function(filteredIds){return this.filteredCount=this._ids.filter(function(id){return filteredIds.indexOf(id)>-1}).length,this.disabled=0===this.filteredCount,this},extend(HierarchyFilter,AbstractFilter),HierarchyFilter.prototype._setGroup=function(group){this.filters.forEach(function(filter){filter._setGroup(group)}),HierarchyFilter.__super__._setGroup.apply(this,arguments)},HierarchyFilter.prototype.change=function(){return this._checkAll(this.checked),HierarchyFilter.__super__.change.apply(this,arguments)},HierarchyFilter.prototype.visit=function(visitor){return visitor.acceptFilter&&visitor.acceptFilter(this),this.filters.forEach(function(filter){filter.visit(visitor)}),visitor},HierarchyFilter.prototype._reset=function(){return this._checkAll(!1),this._resetCount(),HierarchyFilter.__super__._reset.apply(this,arguments)},HierarchyFilter.prototype._collect=function(){return this.filters.reduce(function(collector,filter){return collector.concat(filter._collect())},this.checked&&0===this.filters.length?this._id:[])},HierarchyFilter.prototype._isFilterApplied=function(){return this.checked||this.filters.some(function(filter){return filter._isFilterApplied()})},HierarchyFilter.prototype._calculate=function(filteredIds){var childLocationCount=this.filters.map(function(filter){return filter._calculate(filteredIds)}),count=this._id.reduce(function(acc,next){return acc+(filteredIds.indexOf(next)>-1?1:0)},0);return this.filteredCount=childLocationCount.reduce(function(total,value){return total+value},count),this.filteredCount},HierarchyFilter.prototype._checkAll=function(checked){return this.checked=checked,this.filters.forEach(function(filter){filter._checkAll(checked)}),this},HierarchyFilter.prototype._resetCount=function(){var childLocationCount=this.filters.map(function(filter){return filter._resetCount()});return this.count=childLocationCount.reduce(function(total,value){return total+value},0===this.filters.length?this._id.length:0),this.filteredCount=this.count,this.count},extend(TextFilter,AbstractFilter),TextFilter.prototype._reset=function(){return this.text="",TextFilter.__super__._reset.apply(this,arguments)},TextFilter.prototype._collect=function(){var textMap=this._textMap,text=this.text.toLowerCase(),ids=Object.keys(textMap).map(function(name){return name.toLowerCase().indexOf(text)>-1?[textMap[name]]:[]});return ids.reduce(function(collector,id){return collector.concat(id)},[])},TextFilter.prototype._isFilterApplied=function(){return""!==this.text},FilterMediator.Events={},FilterMediator.Events.CHANGE="change",FilterMediator.Events.RESET="reset",FilterMediator.prototype.reset=function(){return this.groups.forEach(function(group){return group.reset()}),this.filteredCount=0,this._notify(FilterMediator.Events.RESET)},FilterMediator.prototype.isFilterApplied=function(){return this.groups.some(function(group){return group.isFilterApplied()})},FilterMediator.prototype.addListener=function(listener){return this._listeners.push(listener),this},FilterMediator.prototype.removeListener=function(listener){var index=this._listeners.indexOf(listener);return index>-1&&this._listeners.splice(index,1),this},FilterMediator.prototype.removeListeners=function(){return this._listeners=[],this},FilterMediator.prototype.visit=function(visitor){return this.groups.forEach(function(group){group.visit(visitor)}),visitor},FilterMediator.prototype.change=function(){return this[this.isFilterApplied()?"_calculate":"reset"](),this},FilterMediator.prototype.setBatchMode=function(enableBatch){return this._batch=enableBatch,this[this.isFilterApplied()?"_calculate":"reset"](),this},FilterMediator.prototype._notify=function(event,filteredIds){if(!this._batch){var mediator=this;this._listeners.forEach(function(listener){listener.call(mediator,event,filteredIds)})}return this},FilterMediator.prototype._collectFiltered=function(){return this.groups.reduce(function(collector,group){return group.isFilterApplied()?collector.concat([group._collect()]):collector},[])},FilterMediator.prototype._calculate=function(){var filtered=andFilter(this._collectFiltered());return this.groups.forEach(function(group){group._calculate(filtered)}),this.filteredCount=filtered.length,this._notify(FilterMediator.Events.CHANGE,filtered)},FilterBuilder.prototype.addCheckBoxFilters=function(name,mode){return this.addCheckBoxFiltersOfType("check",name,mode)},FilterBuilder.prototype.addCheckBoxFiltersOfType=function(type,name,mode){return this._builders.push(new CheckBoxFilterGroupBuilder(type,name,mode)),this._builders[this._builders.length-1]},FilterBuilder.prototype.addHierarchyFilters=function(name){return this._builders.push(new HierarchyFilterGroupBuilder(name)),this._builders[this._builders.length-1]},FilterBuilder.prototype.addTextFilter=function(name){return this._builders.push(new TextFilterGroupBuilder(name)),this._builders[this._builders.length-1]},FilterBuilder.prototype.build=function(){var mediator=new FilterMediator(this._builders.map(function(builder){return builder._build()}));return mediator.groups.forEach(function(group){group._setMediator(mediator),group.filters.forEach(function(filter){filter._setGroup(group)})}),mediator},extend(CheckBoxFilterGroupBuilder,AbstractFilterGroupBuilder),CheckBoxFilterGroupBuilder.prototype.addFilter=function(name,ids){return this._filters.push(new CheckBoxFilter(name,ids)),this},CheckBoxFilterGroupBuilder.prototype._build=function(){return new FilterGroup(this._type,this._name,this._mode,this._filters)},extend(TextFilterGroupBuilder,AbstractFilterGroupBuilder),TextFilterGroupBuilder.prototype.setFilter=function(textMap){return this._filters=Object.keys(textMap).length>0?[new TextFilter(textMap)]:[],this},TextFilterGroupBuilder.prototype._build=function(){return new FilterGroup(this._type,this._name,this._mode,this._filters)},extend(HierarchyFilterGroupBuilder,AbstractFilterGroupBuilder),HierarchyFilterGroupBuilder.prototype.addFilter=function(name,id){return this._filters.push(new HierarchyFilterBuilder(name,id)),this._filters[this._filters.length-1]},HierarchyFilterGroupBuilder.prototype._build=function(){return new HierarchyFilterGroup(this._type,this._name,this._mode,this._filters.map(function(child){return child._build()}))},HierarchyFilterBuilder.prototype.addFilter=function(name,id){return this._filters.push(new HierarchyFilterBuilder(name,id)),this._filters[this._filters.length-1]},HierarchyFilterBuilder.prototype._build=function(){return new HierarchyFilter(this._name,this._id,this._filters.map(function(filter){return filter._build()}))},module.factory("filterBuilder",[function(){var builder=function(){return new FilterBuilder};return builder.MODE=FilterGroup.MODE,builder}])}(angular.module("vhols-filters",[])),function(){"use strict";angular.module("vhols-filters").run(["$templateCache",function($templateCache){$templateCache.put("checkbox-filter.html",'<div class="form check-panel">\n    <div class="checkbox">\n        <label ng-class="{ \'ticked\': group.isFilterApplied() == false }" ng-click="group.reset(); group.change();">\n            <span class="tick"></span>\n            Show all\n        </label>\n    </div>\n    <div class="checkbox" ng-repeat="filter in group.filters">\n        <label ng-class="{ \'text-muted\': filter.filteredCount === 0, \'ticked\': filter.checked }">\n            <span class="tick"></span>\n            <input type="checkbox"\n                   ng-model="filter.checked"\n                   ng-change="filter.change()"/>\n            {{filter.name}}\n            <span ng-show="filter.filteredCount || filter.checked">({{filter.filteredCount}})</span>\n        </label>\n    </div>\n</div>'),$templateCache.put("hierarchy-filter.html",'<div class="hierarchy-filter" ng-if="filter.filters.length &gt; 0">\n    <label ng-class="{ \'text-muted\': filter.filteredCount === 0, \'ticked\': filter.checked }">\n        <span class="tick"></span>\n        <input type="checkbox"\n               ng-model="filter.checked"\n               ng-change="filter.change()"/>\n        <div class="indent">\n            {{filter.name}}\n            <span ng-show="filter.filteredCount || filter.checked">({{filter.filteredCount}})</span>\n        </div>\n    </label>\n    <div ng-repeat="filter in filter.filters" ng-include="\'hierarchy-filter.html\'"></div>\n</div>\n'),$templateCache.put("text-filter.html",'<div class="form-group">\n    <input type="text"\n       ng-model="group.filters[0].text"\n       ng-change="group.change()"\n       class="form-control"\n       placeholder="Filter by name"\n       value="{{name}}">\n   <span ng-click="group.reset(); group.change();"\n         ng-show="group.isFilterApplied();"\n         class="reset-text">X</span>\n</div>')}])}(),function(){"use strict";angular.module("vholsPostCodeAnywhere",[])}(),function(){"use strict";angular.module("vholsPostCodeAnywhere").service("postCodeAnywhereService",function($http){var KEY="AX24-HZ15-CG93-ZP91",PATTERN=/^(GIR|[A-Za-z]\d[A-Za-z\d]??|[A-Za-z]{2}\d[A-Za-z\d]??)[ ]??(\d[A-Za-z]{2})$/,postCodeLookup=function(searchTerm){if(searchTerm&&(searchTerm=searchTerm.toUpperCase()),PATTERN.exec(searchTerm))return $http.jsonp("//services.postcodeanywhere.co.uk/CapturePlus/Interactive/Find/v2.10/json3.ws",{method:"GET",params:{Key:KEY,SearchTerm:searchTerm,LastId:"",SearchFor:"PostalCodes",callback:"JSON_CALLBACK"}});throw new Error("searchTerm provided is not a valid post code.")},fetchAddressById=function(id){if(!id)throw new Error("An address id must be specified");return $http.jsonp("//services.postcodeanywhere.co.uk/CapturePlus/Interactive/Retrieve/v2.10/json3.ws",{method:"GET",params:{Key:KEY,Id:id,callback:"JSON_CALLBACK"}})};return{postCodeLookup:postCodeLookup,fetchAddressById:fetchAddressById}})}(),function(){"use strict";angular.module("vhols-dates",[]),angular.module("vhols-dates").factory("dates",function(){var DatesService=function(){function unwrap(possible){return possible instanceof DatesService?possible.date:possible}function DateService(value,format){value="undefined"==typeof value?new Date:value,this.date=value instanceof Date?moment(value):moment(value,format||DateService.defaultFormat)}return DateService.defaultFormat="DD/MM/YYYY",DateService.years="years",DateService.months="months",DateService.weeks="weeks",DateService.days="days",DateService.day="day",DateService.minutes="minutes",DateService.prototype.asDate=function(){return this.date.toDate()},DateService.prototype.formatISO=function(){return this.date.toISOString()},DateService.prototype.format=function(format){return this.date.format(format||DateService.defaultFormat)},DateService.prototype.addYears=function(value){return this.date.add(value,DateService.years),this},DateService.prototype.addMonths=function(value){return this.date.add(value,DateService.months),this},DateService.prototype.addWeeks=function(value){return this.date.add(value,DateService.weeks),this},DateService.prototype.addDays=function(value){return this.date.add(value,DateService.days),this},DateService.prototype.addMinutes=function(value){return this.date.add(value,DateService.minutes),this},DateService.prototype.isValid=function(){return this.date.isValid()},DateService.prototype.diffYears=function(other){return other.date.diff(this.date,DateService.years)},DateService.prototype.diffMonths=function(other){return other.date.diff(this.date,DateService.months)},DateService.prototype.diffWeeks=function(other){return other.date.diff(this.date,DateService.weeks)},DateService.prototype.diffDays=function(other){return other.date.diff(this.date,DateService.days)},DateService.prototype.diffMinutes=function(other){return other.date.diff(this.date,DateService.minutes)},DateService.prototype.isBefore=function(other,tolerance){return this.date.isBefore(unwrap(other),tolerance||DateService.day)},DateService.prototype.isAfter=function(other,tolerance){return this.date.isAfter(unwrap(other),tolerance||DateService.day)},DateService.prototype.isoWeekday=function(){return this.date.isoWeekday()},DateService.prototype.isSame=function(other,tolerance){return this.date.isSame(unwrap(other),tolerance||DateService.day)},DateService.prototype.isSameOrBefore=function(other,tolerance){return this.isSame(other,tolerance)||this.isBefore(other,tolerance)},DateService.prototype.isSameOrAfter=function(other,tolerance){return this.isSame(other,tolerance)||this.isAfter(other,tolerance)},DateService}();return function(value,format){return new DatesService(value,format)}})}(),function(){"use strict";angular.module("vhols-date-select-list",["vhols-dates","LocalStorageModule"]).controller("VholsDateSelectListCtrl",["$scope","dates","localStorageService",function($scope,dates,localStorageService){$scope.genDates=function(date){var startFrom=$scope.startFrom-1,dateRange=$scope.dateRange,incrementBy=$scope.incrementBy,allDates=[],givenDate=date;givenDate.setHours(0,0,0,0);for(var i=0;i<dateRange;i++){var currentDate=dates(givenDate),interval=startFrom++*incrementBy,incrementingDate=currentDate.addMonths(interval).asDate();allDates.push(dates(incrementingDate).format("YYYY-MM")+"-01")}return allDates},$scope.initPersistence=function(){var theDay=new Date;if($scope.datesArray=$scope.genDates(theDay),$scope.selectedMonth=$scope.datesArray[0],$scope.persistKey){$scope.$watch("selectedMonth",function(value){localStorageService.set($scope.persistKey,value)});var storageStringAsDate=dates(localStorageService.get($scope.persistKey)),firstListedDate=dates($scope.datesArray[0]),validDate=!!storageStringAsDate.isAfter(firstListedDate);$scope.selectedMonth=localStorageService.get($scope.persistKey)&&validDate?localStorageService.get($scope.persistKey):$scope.selectedMonth}}}]).directive("vholsDateSelectList",["$templateCache",function($templateCache){return{restrict:"E",replace:!0,scope:{incrementBy:"=",dateRange:"=",selectedFormat:"=",startFrom:"=",selectedMonth:"=",persistKey:"@"},template:$templateCache.get("vholsDateSelectList.html"),controller:"VholsDateSelectListCtrl",link:function(scope,elem,attrs){scope.initPersistence()}}}])}(),!function(){"use strict";angular.module("vhols-date-select-list").run(["$templateCache",function(t){t.put("vholsDateSelectList.html",'<div class="input-group select-group squared"><select class="form-control" ng-model="selectedMonth" ng-options="dt as (dt | date:selectedFormat) for dt in datesArray"></select><span class="input-group-addon inputAddon"><i class="glyphicon icon-chevron-down"></i></span></div>')}])}(),function(){"use strict";angular.module("vhols-date-input",["vhols-dates"]),angular.module("vhols-date-input").constant("NOW",new Date).controller("DateInputController",["$scope","dates","NOW",function($scope,dates,NOW){function calculateMonths(toShow,selectedIdx){for(var monthsArr=[],startPoint=new Date,i=0;i<=toShow;i++){var dt={label:dates(startPoint).addMonths(i).format(dropDownFormat),idx:i,move:i-selectedIdx};monthsArr.push(dt)}return $scope.selectedMonth=monthsArr[selectedIdx],monthsArr}function moveStep(step){angular.element(document.querySelector(".opened .calendar")).length>0&&angular.element(document.querySelector(".opened .calendar")).scope().$parent.move(step)}function resetCalendar(calElm,newDate){angular.element(calElm).length>0&&angular.element(calElm).scope().$parent.select(newDate)}function setStartIdx(){var dt="end"===$scope.popupType?$scope.date:$scope.monthOnView,idx=$scope.dateSelections.filter(function(obj){return obj.label==dates(dt).format(dropDownFormat)})[0];if(idx)return $scope.dateSelections=calculateMonths($scope.monthsToShow,idx.idx),idx.idx}var dropDownFormat="MMM YYYY";$scope.selectedMonth={},$scope.monthsToShow=$scope.monthsToShow?$scope.monthsToShow:8;$scope.showWeeks=!1,$scope.opened=!1,$scope.dateOptions={"starting-day":1,"show-button-bar":!1,"show-weeks":!1},$scope.open=function($event){dates($scope.monthOnView).isSame($scope.date,"months")||($scope.monthOnView=$scope.date,resetCalendar(document.querySelector(".opened .calendar"),$scope.date)),$event.preventDefault(),$event.stopPropagation(),$scope.dateSelections=calculateMonths($scope.monthsToShow,0),$scope.monthsFromStart=setStartIdx(),$scope.opened=!0},$scope.monthSelection=function(val){$scope.dateSelections=calculateMonths($scope.monthsToShow,val)},$scope.monthMove=function(step){$scope.monthOnView=dates(new Date).addMonths($scope.monthsFromStart).asDate(),moveStep(step)},$scope.$watch("watchCheckIn",function(newDate){"undefined"!=typeof newDate&&($scope.date=dates(newDate).addDays($scope.noNights).asDate(),$scope.minDate=dates(newDate).addDays($scope.minNights).asDate(),$scope.maxDate=dates(newDate).addDays($scope.maxNights).asDate())})}]),angular.module("vhols-date-input").directive("vholsDateInput",[function(){return{replace:!0,scope:{placeholder:"@",dateName:"=",date:"=",minDate:"=",maxDate:"=",monthsToShow:"=",label:"@",format:"@",icon:"=",dateInputId:"@"},templateUrl:"vholsdateinput.html",controller:"DateInputController"}}]),angular.module("vhols-date-input").directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(scope,element,attr,controller){controller.$formatters.shift()}}})}(),angular.module("vhols-date-input").run(["$templateCache",function($templateCache){$templateCache.put("vholsdateinput.html",'<div class="date-picker-wrapper" ng-class="{\'show-icon\': icon}">\n    <label for="{{label}}">{{label}}</label>\n    <div class="wrapper-icon">\n        <i class="icon-sp-calendar" ng-if="icon"></i>\n        <input id="{{label}}" type="text" class="form-control"\n           ng-model="date"\n           is-open="opened"\n           min-date="minDate"\n           max-date="maxDate"\n           months-to-show="$parent.monthsToShow"\n           datepicker-popup="{{format}}"\n           placeholder="{{placeholder}}"\n           dateSelections="dateSelections"\n           datepicker-options="dateOptions"\n           ng-required="true"\n           datepicker-append-to-body="true"\n           show-button-bar="false"\n           ng-click="open($event)" />\n    </div>    \n</div>'),
$templateCache.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)" ng-init="monthsToShow = $root.monthsToShow">\n    <span ng-init="monthSelection = $parent.monthSelection"></span>\n    <span ng-init="selectedMonth = $parent.selectedMonth"></span>\n    <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n    <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n    <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>'),$templateCache.put("template/datepicker/day.html",'<div class="calendar">\n    <table>\n        <thead>\n        <tr class="headings">\n            <th ng-show="showWeeks" class="text-center"></th>\n            <th ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.abbr}}</small></th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="row in rows track by $index">\n            <td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n            <td ng-repeat="(daynum, dt) in row track by dt.date" ng-class="{\'direct-flight\' : directFlight(dt.date) && !dt.secondary && !dt.disabled, \'foof\': dt.secondary}" class="text-center day-box" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n                <button type="button"\n                        class="btn btn-default btn-sm btn-sq btn-dt-select"\n                        ng-class="{\'btn-info\': dt.selected, \'direct-flight\' : directFlight(dt.date), \'btn-secondary\' : dt.secondary}"\n                        ng-click="select(dt.date)"\n                        ng-disabled="dt.disabled">\n                             <span class="day-name">{{labels[daynum].abbr}}</span>\n                            {{dt.label | number}}\n                </button>\n            </td>\n        </tr>\n        </tbody>\n    </table>\n</div>\n'),$templateCache.put("template/datepicker/popup.html",'<div class="modal fade in datepicker {{$parent.popupType}}" ng-click="isOpen = false" ng-show="isOpen" ng-class="{\'opened\': isOpen}" ng-style="{display: (isOpen && \'block\') || \'none\'}">\n    <div class="modal-dialog" stop-event="touchend" ng-init="monthsLimit = $parent.monthsToShow" ng-click="$event.stopPropagation();">\n\n        <div class="modal-content modal-content-calendar">\n            <div class="calendarHeader">\n                <div class="dialogHeader">\n                    <div class="row">\n                        <div class="col-xs-8">\n                            <span class="title">{{$parent.dateLabel}}</span>\n                        </div>\n                        <div class="col-xs-4 text-right">\n                            <a href="" class="vIconAlign" ng-click="isOpen = false"><span class="text">{{closeText}}</span> <i class="icon-close"></i></a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div>\n                <div class="row dateHeader">\n                    <div class="col-xs-4">\n                        <button class="control btn btn-link pull-left"\n                                type="button"\n                                disabled="disabled"\n                                ng-click="$parent.monthsFromStart = $parent.monthsFromStart - 1;$parent.monthMove(-1);$parent.monthSelection($parent.monthsFromStart);"\n                                ng-disabled="$parent.monthsFromStart < 1">\n                            <i class="du-icon-chevron-left"></i>\n                            <span class="month-select-text previous-month-select">Previous <span class="extended-text">month</span></span>\n                        </button>\n                    </div>\n                    <div class="col-xs-4 text-center">\n                        <div class="month-selector pl-select-box">\n                            <select\n                                    stop-event="touchend"\n                                    class="form-control"\n                                    id="month-selector"\n                                    ng-model="$parent.selectedMonth"\n                                    ng-options="item.label for item in $parent.dateSelections track by item.move"\n                                    ng-change="$parent.monthsFromStart = $parent.selectedMonth.idx;$parent.monthMove($parent.selectedMonth.move);$parent.monthSelection($parent.monthsFromStart);"></select>\n                        </div>\n                    </div>\n                    <div class="col-xs-4">\n                        <button class="control btn btn-link pull-right"\n                                type="button"\n                                ng-click="$parent.monthsFromStart = $parent.monthsFromStart + 1;$parent.monthMove(1);$parent.monthSelection($parent.monthsFromStart);"\n                                ng-disabled="$parent.monthsFromStart >= $parent.monthsToShow">\n                            <i class="du-icon-chevron-right"></i>\n                            <span class="month-select-text next-month-select">Next <span class="extended-text">month</span></span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <div ng-transclude></div>\n        </div>\n    </div>\n</div>\n')}]);
//# sourceMappingURL=maps/virginholidays-web-vhols.secondary-3.5.23.min.js.map
